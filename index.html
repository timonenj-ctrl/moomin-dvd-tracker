<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Moomin DVDs ‚Äî Marketplace Tracker</title>

<style>
:root{
  --bg:#ffffff;--panel:#fbfbfa;--text:#2f3437;--muted:#6b6f76;
  --border:rgba(55,53,47,0.16);--pill:#f1f1ef;--link:#0b6e99;
}
[data-theme="dark"]{
  --bg:#191919;--panel:#202020;--text:#f1f1ef;--muted:#b6b6b3;
  --border:rgba(255,255,255,0.14);--pill:#2a2a2a;--link:#7cc5ff;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial;
  background:var(--bg);color:var(--text)
}
a{color:var(--link);text-decoration:none}
a:hover{text-decoration:underline}

.app{display:grid;grid-template-columns:300px 1fr;min-height:100vh}
.sidebar{
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:16px;
}
.main{padding:36px;max-width:1100px}

.brand{font-weight:800;font-size:18px;margin-bottom:12px}

.controls{display:flex;gap:8px;margin-bottom:14px}
.btn{
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
  padding:6px 10px;
  border-radius:8px;
  cursor:pointer;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:14px;
  margin-top:18px
}
.card{
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px
}
.card h3{margin:0 0 6px}

.section-title{
  margin-top:26px;
  font-size:20px;
  font-weight:750
}
.small{color:var(--muted);font-size:13px}
ul{margin:8px 0 0 18px}

@media(max-width:900px){
  .app{grid-template-columns:1fr}
  .sidebar{border-right:none;border-bottom:1px solid var(--border)}
}
</style>
</head>

<body data-theme="dark">
<div class="app">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="brand">üìÄ Moomin DVDs</div>

  <div class="controls">
    <button class="btn" id="homeBtn">üè† Home</button>
    <button class="btn" id="themeBtn">üåì</button>
    <button class="btn" id="copyBtn">üîó</button>
  </div>

  <div id="sideNav" class="small"></div>
</aside>

<!-- MAIN -->
<main class="main">
  <h1 id="title">Moomin DVDs ‚Äî Marketplace Tracker</h1>
  <p id="subtitle" class="small">
    Choose a country to see local marketplaces and search terms.
  </p>

  <!-- COUNTRY PICKER -->
  <div id="countryGrid" class="grid"></div>

  <!-- COUNTRY CONTENT -->
  <div id="content"></div>
</main>
</div>

<script>
const $ = s => document.querySelector(s);
const grid = $("#countryGrid");
const content = $("#content");
const sideNav = $("#sideNav");

function esc(s){return (s||"").replace(/[&<>"']/g,m=>(
  {"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]
));}

async function init(){
  const res = await fetch("./data/sources.json");
  window.DATA = await res.json();
  renderHome();
}

function getCountryFromHash(){
  const m = location.hash.match(/c=([A-Z]{2})/);
  return m ? m[1] : null;
}

function renderHome(){
  $("#title").textContent = "Moomin DVDs ‚Äî Marketplace Tracker";
  $("#subtitle").textContent = "Choose a country to see local marketplaces and search terms.";
  content.innerHTML = "";
  sideNav.innerHTML = "<b>Pick a country</b>";
  grid.style.display = "grid";

  grid.innerHTML = DATA.countries.map(c=>`
    <div class="card">
      <h3>${c.flag} ${esc(c.country)}</h3>
      <div class="small">${esc(c.language)}</div>
      <div style="margin-top:10px">
        <a href="#c=${c.code}">Open ‚Üí</a>
      </div>
    </div>
  `).join("");
}

function renderCountry(code){
  const c = DATA.countries.find(x=>x.code===code);
  if(!c){renderHome();return;}

  grid.style.display = "none";
  $("#title").textContent = `${c.flag} ${c.country}`;
  $("#subtitle").textContent = `Local names, marketplaces and search links (${c.language})`;
  sideNav.innerHTML = `<b>${c.country}</b><br><span class="small">${c.language}</span>`;

  const grouped = {};
  (c.sources||[]).forEach(s=>{
    (grouped[s.type]=grouped[s.type]||[]).push(s);
  });

  content.innerHTML = `
    <div class="section-title">Local names & search terms</div>
    <ul>
      ${(c.local_names||[]).map(n=>`<li>${esc(n)}</li>`).join("")}
      ${(c.search_terms||[]).map(t=>`<li><i>${esc(t)}</i></li>`).join("")}
    </ul>

    <div class="section-title">Marketplaces</div>
    ${Object.keys(grouped).map(type=>`
      <div class="section-title" style="font-size:16px">${esc(type)}</div>
      ${grouped[type].map(src=>`
        <div class="card">
          <h3>${esc(src.name)}</h3>
          <p class="small">${esc(src.note||"")}</p>
          <ul>
            ${(src.search_urls||[]).map(u=>`
              <li><a href="${u.url}" target="_blank">${esc(u.label)}</a></li>
            `).join("")}
          </ul>
        </div>
      `).join("")}
    `).join("")}
  `;
}

window.addEventListener("hashchange", ()=>{
  const c = getCountryFromHash();
  c ? renderCountry(c) : renderHome();
});

$("#homeBtn").onclick = ()=>{
  history.pushState({}, "", location.pathname);
  renderHome();
};

$("#themeBtn").onclick = ()=>{
  document.body.dataset.theme =
    document.body.dataset.theme === "dark" ? "light" : "dark";
};

$("#copyBtn").onclick = async ()=>{
  await navigator.clipboard.writeText(location.href);
};

init();
</script>
</body>
</html>
